
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stained Glass Documentation Tool</title>
    <meta name="description" content="Document, preserve, and share knowledge about stained glass heritage with structured metadata export capabilities.">
    <meta name="keywords" content="stained glass, cultural heritage, art history, documentation, research tool">
    <meta name="author" content="Stained Glass Documentation Tool">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="app.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Open Graph meta tags for social sharing -->
    <meta property="og:title" content="Stained Glass Documentation Tool">
    <meta property="og:description" content="Document, preserve, and share knowledge about stained glass heritage">
    <meta property="og:type" content="website">
    <meta property="og:image" content="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Main Container -->
    <div class="container">
        <!-- Header Section -->
        <header>
            <h1>Stained Glass Documentation Tool</h1>
            <p>Document, preserve, and share knowledge about stained glass heritage</p>
        </header>

        <!-- Main Navigation -->
        <nav class="main-nav" role="navigation" aria-label="Main navigation">
            <button onclick="showView('list')" aria-label="View documented windows" class="btn-primary">
                <span aria-hidden="true">üìã</span> 
                <span>View Windows</span>
            </button>
            <button onclick="showView('form')" aria-label="Add new window" class="btn-primary">
                <span aria-hidden="true">‚ûï</span> 
                <span>Add Window</span>
            </button>
            <button onclick="importWikidataFile()" aria-label="Import from Wikidata" class="btn-secondary">
                <span aria-hidden="true">üì•</span> 
                <span>Import Wikidata</span>
            </button>
            <button onclick="importCSVFile()" aria-label="Import from CSV" class="btn-secondary">
                <span aria-hidden="true">üìÑ</span> 
                <span>Import CSV</span>
            </button>
            <button onclick="exportData()" aria-label="Export as JSON-LD" class="btn-secondary">
                <span aria-hidden="true">üíæ</span> 
                <span>Export JSON-LD</span>
            </button>
            <button onclick="exportCSV()" aria-label="Export as CSV" class="btn-secondary">
                <span aria-hidden="true">üìä</span> 
                <span>Export CSV</span>
            </button>
            <button onclick="showView('about')" aria-label="About this tool" class="btn-secondary">
                <span aria-hidden="true">‚ÑπÔ∏è</span> 
                <span>About</span>
            </button>
        </nav>

        <!-- Status Messages -->
        <div id="status-message" aria-live="polite" role="status"></div>

        <!-- Main Content -->
        <main id="main-content">
            
            <!-- ================================================================
                 LIST VIEW - Documented Windows
                 ================================================================ -->
            <div id="list-view" class="view active">
                <div class="view-header">
                    <h2>Documented Windows</h2>
                    
                    <!-- Search Interface -->
                    <div class="search-container">
                        <div class="search-box">
                            <input 
                                type="text" 
                                id="search-input" 
                                placeholder="Search windows by title, location, or description..." 
                                aria-label="Search windows by title, location, or description"
                                autocomplete="off"
                            >
                            <button 
                                type="button" 
                                class="search-clear" 
                                onclick="clearSearch()" 
                                aria-label="Clear search"
                                style="display: none;"
                            >
                                <span aria-hidden="true">‚úï</span>
                            </button>
                        </div>
                        <div id="search-status" class="search-status" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Statistics Dashboard -->
                <div class="stats" role="region" aria-label="Collection statistics">
                    <div class="stat-card">
                        <div class="stat-number" id="total-windows" aria-label="Total number of windows">0</div>
                        <div class="stat-label">Total Windows</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="countries-count" aria-label="Number of countries represented">0</div>
                        <div class="stat-label">Countries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="date-range" aria-label="Date range of collection">-</div>
                        <div class="stat-label">Date Range</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="storage-usage" aria-label="Storage space used">-</div>
                        <div class="stat-label">Storage Used</div>
                    </div>
                </div>

                <!-- Windows List -->
                <div id="windows-list" class="window-list" role="region" aria-label="List of documented windows">
                    <!-- Dynamic content populated by JavaScript -->
                </div>
            </div>

            <!-- ================================================================
                 FORM VIEW - Add/Edit Window
                 ================================================================ -->
            <div id="form-view" class="view">
                <div class="view-header">
                    <h2 id="form-title">Add New Window</h2>
                    <div class="form-help">
                        <p>Fields marked with <span class="required" aria-label="required">*</span> are required for documentation</p>
                    </div>
                </div>

                <form id="window-form" novalidate>
                    <!-- Basic Window Information -->
                    <fieldset>
                        <legend>Basic Window Information</legend>
                        
                        <div class="form-group">
                            <label for="title">
                                Window Title 
                                <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="title" 
                                name="title" 
                                required 
                                aria-describedby="title-help"
                                autocomplete="off"
                                placeholder="e.g., Rose Window of Notre-Dame"
                            >
                            <small id="title-help" class="help-text">A descriptive name for this window</small>
                        </div>

                        <div class="form-group">
                            <label for="building">
                                Building/Institution 
                                <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="building" 
                                name="building" 
                                required 
                                aria-describedby="building-help"
                                autocomplete="off"
                                placeholder="e.g., Cathedral of Notre-Dame"
                            >
                            <small id="building-help" class="help-text">Church, cathedral, museum, or other building where the window is located</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">
                                    City 
                                    <span class="required" aria-label="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="city" 
                                    name="city" 
                                    required 
                                    autocomplete="address-level2"
                                    placeholder="e.g., Paris"
                                >
                            </div>

                            <div class="form-group">
                                <label for="country">
                                    Country 
                                    <span class="required" aria-label="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="country" 
                                    name="country" 
                                    required 
                                    autocomplete="country"
                                    placeholder="e.g., France"
                                >
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="date">
                                Creation Date 
                                <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="date" 
                                name="date" 
                                required 
                                placeholder="e.g., 1920, c. 1850, 13th century"
                                aria-describedby="date-help"
                                autocomplete="off"
                            >
                            <small id="date-help" class="help-text">Use any format that describes when the window was created</small>
                        </div>

                        <!-- Materials Selection -->
                        <div class="form-group">
                            <fieldset>
                                <legend>
                                    Materials Used 
                                    <span class="required" aria-label="required">*</span>
                                </legend>
                                <div class="checkbox-group" role="group" aria-describedby="materials-help">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-stained-glass" name="materials" value="Stained Glass">
                                        <label for="mat-stained-glass">Stained Glass</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-painted-glass" name="materials" value="Painted Glass">
                                        <label for="mat-painted-glass">Painted Glass</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-clear-glass" name="materials" value="Clear Glass">
                                        <label for="mat-clear-glass">Clear Glass</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-lead-came" name="materials" value="Lead Came">
                                        <label for="mat-lead-came">Lead Came</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-silver-stain" name="materials" value="Silver Stain">
                                        <label for="mat-silver-stain">Silver Stain</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-vitreous-paint" name="materials" value="Vitreous Paint">
                                        <label for="mat-vitreous-paint">Vitreous Paint</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-other" name="materials" value="Other">
                                        <label for="mat-other">Other Materials</label>
                                    </div>
                                </div>
                                <input 
                                    type="text" 
                                    id="materials-other" 
                                    name="materialsOther" 
                                    placeholder="Specify other materials used" 
                                    style="margin-top: 0.75rem; display: none;"
                                    aria-label="Other materials specification"
                                >
                                <small id="materials-help" class="help-text">Select all materials that apply to this window</small>
                            </fieldset>
                        </div>
                    </fieldset>

                    <!-- Optional Fields Section -->
                    <div class="optional-section">
                        <button 
                            type="button" 
                            class="optional-toggle" 
                            onclick="toggleOptionalFields()"
                            aria-expanded="false"
                            aria-controls="optional-fields"
                        >
                            <span id="optional-toggle-text">Show Optional Fields</span>
                            <span class="toggle-icon" aria-hidden="true">‚ñº</span>
                        </button>
                        
                        <div id="optional-fields" class="optional-fields">
                            <fieldset>
                                <legend>Optional Window Details</legend>
                                
                                <div class="form-group">
                                    <label for="alternative-titles">Alternative Titles</label>
                                    <input 
                                        type="text" 
                                        id="alternative-titles" 
                                        name="alternativeTitles" 
                                        placeholder="Separate multiple titles with commas"
                                        aria-describedby="alt-titles-help"
                                        autocomplete="off"
                                    >
                                    <small id="alt-titles-help" class="help-text">Other names this window is known by</small>
                                </div>

                                <div class="form-group">
                                    <label for="specific-location">Specific Location within Building</label>
                                    <input 
                                        type="text" 
                                        id="specific-location" 
                                        name="specificLocation" 
                                        placeholder="e.g., North transept, Chapel of St. Mary"
                                        aria-describedby="location-help"
                                        autocomplete="off"
                                    >
                                    <small id="location-help" class="help-text">More precise location within the building</small>
                                </div>

                                <div class="form-group">
                                    <label>Window Dimensions</label>
                                    <div class="dimensions-group">
                                        <div class="dimension-input">
                                            <label for="width" class="sr-only">Width</label>
                                            <input 
                                                type="number" 
                                                id="width" 
                                                name="width" 
                                                placeholder="Width" 
                                                step="0.1"
                                                min="0"
                                                aria-label="Window width"
                                            >
                                        </div>
                                        <div class="dimension-input">
                                            <label for="height" class="sr-only">Height</label>
                                            <input 
                                                type="number" 
                                                id="height" 
                                                name="height" 
                                                placeholder="Height" 
                                                step="0.1"
                                                min="0"
                                                aria-label="Window height"
                                            >
                                        </div>
                                        <div class="dimension-input">
                                            <label for="dimension-unit" class="sr-only">Measurement unit</label>
                                            <select id="dimension-unit" name="dimensionUnit" aria-label="Dimension unit">
                                                <option value="cm">cm</option>
                                                <option value="m">m</option>
                                                <option value="in">in</option>
                                                <option value="ft">ft</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="image-url">Image URL</label>
                                    <input 
                                        type="url" 
                                        id="image-url" 
                                        name="imageUrl" 
                                        placeholder="https://commons.wikimedia.org/wiki/Special:FilePath/..."
                                        aria-describedby="image-help"
                                        autocomplete="off"
                                    >
                                    <small id="image-help" class="help-text">
                                        Wikimedia Commons image URL (will be displayed as thumbnail in the gallery)
                                    </small>
                                    <div id="image-preview" class="image-preview" aria-live="polite"></div>
                                </div>

                                <div class="form-group">
                                    <label for="description">Detailed Description</label>
                                    <textarea 
                                        id="description" 
                                        name="description" 
                                        placeholder="Describe the window's iconography, artistic style, condition, historical significance, or other notable features..."
                                        aria-describedby="description-help"
                                        rows="4"
                                    ></textarea>
                                    <small id="description-help" class="help-text">Detailed description of the window's appearance, significance, and context</small>
                                </div>

                                <div class="form-group">
                                    <label for="subject-tags">Subject/Iconography Tags</label>
                                    <input 
                                        type="text" 
                                        id="subject-tags" 
                                        name="subjectTags" 
                                        placeholder="e.g., Christ, Virgin Mary, saints, biblical scenes, Last Judgment (separate with commas)"
                                        aria-describedby="tags-help"
                                        autocomplete="off"
                                    >
                                    <small id="tags-help" class="help-text">Keywords describing the window's subject matter and iconographic elements</small>
                                </div>
                            </fieldset>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" id="save-btn" class="btn-primary">
                            <span aria-hidden="true">üíæ</span> 
                            <span>Save Window</span>
                        </button>
                        <button type="button" class="btn-secondary" onclick="resetForm()">
                            <span aria-hidden="true">üîÑ</span> 
                            <span>Clear Form</span>
                        </button>
                        <button type="button" class="btn-secondary" onclick="showView('list')">
                            <span aria-hidden="true">‚ùå</span> 
                            <span>Cancel</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- ================================================================
                 ABOUT VIEW - Information and Help
                 ================================================================ -->
            <div id="about-view" class="view">
                <div class="view-header">
                    <h2>About This Tool</h2>
                </div>
                
                <div class="about-content">
                    <section aria-labelledby="about-overview">
                        <h3 id="about-overview">Overview</h3>
                        <p>The Stained Glass Documentation Tool is a specialized research instrument designed to help scholars, historians, and cultural heritage professionals document stained glass windows with structured metadata that can be exported in standard formats for long-term preservation and academic sharing.</p>
                        
                        <p>This tool addresses the critical need for standardized documentation of stained glass heritage, enabling researchers to create comprehensive, searchable records that contribute to the preservation of cultural knowledge.</p>
                    </section>

                    <section aria-labelledby="about-features">
                        <h3 id="about-features">Key Features</h3>
                        <ul>
                            <li><strong>Complete offline functionality</strong> - No internet connection required for documentation work</li>
                            <li><strong>Standards-compliant export</strong> - JSON-LD and CSV formats following Schema.org specifications</li>
                            <li><strong>Secure browser-based storage</strong> - Your research data stays privately on your device</li>
                            <li><strong>Comprehensive import capabilities</strong> - Import from Wikidata exports and CSV spreadsheets</li>
                            <li><strong>Real-time search and filtering</strong> - Find specific windows quickly as your collection grows</li>
                            <li><strong>Integrated image support</strong> - Display and manage images with optimized loading</li>
                            <li><strong>Responsive design</strong> - Works seamlessly on desktop, tablet, and mobile devices</li>
                            <li><strong>Full accessibility support</strong> - Complete keyboard navigation and screen reader compatibility</li>
                            <li><strong>Auto-save functionality</strong> - Automatic draft saving prevents data loss during documentation</li>
                            <li><strong>Provenance tracking</strong> - Maintains creation and modification timestamps for research integrity</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-getting-started">
                        <h3 id="about-getting-started">Getting Started</h3>
                        <ol>
                            <li>Click <strong>"Add Window"</strong> to begin documenting your first stained glass window</li>
                            <li>Complete all required fields (marked with <span class="required">*</span>) for basic documentation</li>
                            <li>Expand the optional fields section for detailed scholarly information</li>
                            <li>Add image URLs from Wikimedia Commons if high-quality images are available</li>
                            <li>Save your record and continue documenting additional windows</li>
                            <li>Use the search functionality to locate specific windows in your growing collection</li>
                            <li>Export your research data in JSON-LD or CSV format for preservation or sharing</li>
                            <li>Import existing data from Wikidata exports or CSV files to build your collection</li>
                        </ol>
                    </section>

                    <section aria-labelledby="about-import-export">
                        <h3 id="about-import-export">Data Import & Export</h3>
                        
                        <h4>Export Formats:</h4>
                        <ul>
                            <li><strong>JSON-LD (Linked Data)</strong> - Standards-compliant format following Schema.org VisualArtwork specification, ideal for digital humanities tools and long-term preservation</li>
                            <li><strong>CSV (Comma-Separated Values)</strong> - Spreadsheet-friendly format for statistical analysis, data manipulation, and integration with other research tools</li>
                        </ul>
                        
                        <h4>Import Sources:</h4>
                        <ul>
                            <li><strong>Wikidata Exports</strong> - Import structured cultural heritage data from Wikidata including automatic image URL extraction</li>
                            <li><strong>CSV Files</strong> - Import data from spreadsheets, databases, or other documentation systems with flexible field mapping</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-images">
                        <h3 id="about-images">Image Management</h3>
                        <ul>
                            <li><strong>Wikimedia Commons integration</strong> - Direct support for Commons image URLs with automatic thumbnail generation</li>
                            <li><strong>Optimized performance</strong> - Lazy loading ensures fast page rendering with large collections</li>
                            <li><strong>Full-size viewing</strong> - Click any thumbnail to view the complete high-resolution image</li>
                            <li><strong>Export compatibility</strong> - Image URLs are preserved in both JSON-LD and CSV export formats</li>
                            <li><strong>Accessibility support</strong> - Proper alt text and keyboard navigation for all image functionality</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-technical">
                        <h3 id="about-technical">Technical Specifications</h3>
                        <ul>
                            <li><strong>Technology Stack:</strong> Modern HTML5, CSS3, and ES6+ JavaScript</li>
                            <li><strong>Dependencies:</strong> Zero external dependencies - completely self-contained</li>
                            <li><strong>Browser Compatibility:</strong> Chrome 90+, Firefox 88+, Safari 14+, Edge 90+</li>
                            <li><strong>Data Storage:</strong> Browser localStorage with typically 5-10MB capacity available</li>
                            <li><strong>Privacy:</strong> All data stored locally on your device, no external servers or tracking</li>
                            <li><strong>Performance:</strong> Intersection Observer API for efficient image loading and smooth scrolling</li>
                            <li><strong>Standards Compliance:</strong> WCAG 2.1 AA accessibility standards</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-keyboard">
                        <h3 id="about-keyboard">Keyboard Shortcuts</h3>
                        <ul>
                            <li><strong>Ctrl+S (Cmd+S on Mac):</strong> Save the current form</li>
                            <li><strong>Escape:</strong> Close modal dialogs or clear search input</li>
                            <li><strong>Tab / Shift+Tab:</strong> Navigate between form fields and interactive elements</li>
                            <li><strong>Enter:</strong> Submit forms or activate focused buttons</li>
                            <li><strong>Space:</strong> Toggle checkboxes and activate buttons</li>
                            <li><strong>Arrow keys:</strong> Navigate within select dropdowns</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-data-integrity">
                        <h3 id="about-data-integrity">Data Integrity & Validation</h3>
                        <ul>
                            <li><strong>Required field validation</strong> - Ensures essential information is captured for each window</li>
                            <li><strong>Duplicate detection</strong> - Prevents accidental creation of duplicate records</li>
                            <li><strong>Data type validation</strong> - Ensures numeric fields contain valid numbers</li>
                            <li><strong>Draft recovery</strong> - Automatically recovers unsaved work after browser interruptions</li>
                            <li><strong>Export validation</strong> - Verifies data integrity before generating export files</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-version">
                        <h3 id="about-version">Version Information</h3>
                        <p>
                            <strong>Version:</strong> 1.1 with Image Support<br>
                            <strong>Last Updated:</strong> <span id="last-updated">2025</span><br>
                            <strong>License:</strong> Open Source<br>
                            <strong>Status:</strong> Production Ready for Academic Use
                        </p>
                        
                        <p>This tool has been successfully tested with collections of 3,000+ windows and is ready for deployment in academic and research environments.</p>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- ================================================================
         MODAL DIALOGS
         ================================================================ -->

    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal" role="dialog" aria-labelledby="delete-modal-title" aria-hidden="true">
        <div class="modal-content">
            <h3 id="delete-modal-title">Confirm Deletion</h3>
            <p>Are you sure you want to permanently delete this window record? This action cannot be undone and will remove all associated data.</p>
            <div class="modal-actions">
                <button class="btn-danger" onclick="confirmDelete()">
                    <span aria-hidden="true">üóëÔ∏è</span> 
                    <span>Delete Permanently</span>
                </button>
                <button class="btn-secondary" onclick="closeModal()">
                    <span aria-hidden="true">‚ùå</span> 
                    <span>Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="image-modal" class="image-modal" role="dialog" aria-labelledby="modal-caption" aria-hidden="true">
        <div class="modal-image-container">
            <button class="modal-close" onclick="closeImageModal()" aria-label="Close image viewer">
                <span aria-hidden="true">&times;</span>
            </button>
            <img id="modal-image" class="modal-image" src="" alt="" tabindex="0">
            <div id="modal-caption" class="modal-caption"></div>
        </div>
    </div>

    <!-- Loading Indicator -->
    <div id="loading-indicator" class="loading-indicator" aria-hidden="true" role="status" aria-label="Loading">
        <div class="spinner"></div>
        <p>Processing your request...</p>
    </div>

    <script src="app.js"></script>
    <script src="import-export.js"></script>

    <script>
        // Set last updated date
        document.getElementById('last-updated').textContent = new Date().getFullYear();
        
        // Update search clear button visibility
        document.getElementById('search-input').addEventListener('input', function() {
            const clearButton = document.querySelector('.search-clear');
            clearButton.style.display = this.value ? 'block' : 'none';
        });

        // Image modal keyboard handling
        document.addEventListener('keydown', function(e) {
            const modal = document.getElementById('image-modal');
            if (modal.style.display === 'block') {
                if (e.key === 'Escape') {
                    closeImageModal();
                }
            }
        });

        // Click outside modal to close
        document.getElementById('image-modal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeImageModal();
            }
        });

        // Image URL preview functionality
        document.addEventListener('DOMContentLoaded', function() {
            const imageUrlInput = document.getElementById('image-url');
            if (imageUrlInput) {
                imageUrlInput.addEventListener('input', function() {
                    const url = this.value;
                    const preview = document.getElementById('image-preview');
                    
                    // Simple URL validation for Wikimedia Commons
                    if (url && url.includes('commons.wikimedia.org')) {
                        let thumbnailUrl = url;
                        
                        // Convert different URL formats to FilePath format
                        if (url.includes('wiki/File:')) {
                            const filename = url.split('File:')[1];
                            thumbnailUrl = `https://commons.wikimedia.org/wiki/Special:FilePath/${filename}`;
                        }
                        
                        // Add width parameter for thumbnail
                        if (thumbnailUrl.includes('Special:FilePath/')) {
                            thumbnailUrl += (thumbnailUrl.includes('?') ? '&' : '?') + 'width=200';
                        }
                        
                        preview.innerHTML = `
                            <img src="${thumbnailUrl}" 
                                 alt="Preview" 
                                 class="form-image-preview"
                                 onerror="this.style.display='none'">
                        `;
                    } else {
                        preview.innerHTML = '';
                    }
                });
            }
        });

        // Initialize image functionality when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize image observer for lazy loading
            if (typeof initializeImageObserver === 'function') {
                initializeImageObserver();
            }
        });
    </script>
</body>
</html>