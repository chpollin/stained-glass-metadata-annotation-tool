<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stained Glass Documentation Tool</title>
    <meta name="description" content="Document, preserve, and share knowledge about stained glass heritage with structured metadata export capabilities.">
    <meta name="keywords" content="stained glass, cultural heritage, art history, documentation, research tool">
    <meta name="author" content="Stained Glass Documentation Tool">
    <meta name="theme-color" content="#2563eb">
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="style.css" as="style">
    <link rel="preload" href="app.js" as="script">
    <link rel="preload" href="table.js" as="script">
    
    <!-- Stylesheets -->
    <link rel="stylesheet" href="style.css">
    
    <!-- Open Graph meta tags for social sharing -->
    <meta property="og:title" content="Stained Glass Documentation Tool">
    <meta property="og:description" content="Document, preserve, and share knowledge about stained glass heritage">
    <meta property="og:type" content="website">
    <meta property="og:image" content="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üèõÔ∏è</text></svg>">
</head>
<body>
    <!-- Skip Link for Accessibility -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Main Container -->
    <div class="container">
        <!-- Header Section -->
        <header>
            <h1>Stained Glass Documentation Tool</h1>
            <p>Document, preserve, and share knowledge about stained glass heritage</p>
        </header>

        <!-- Main Navigation -->
        <nav class="main-nav" role="navigation" aria-label="Main navigation">
            <div class="nav-group">
                <button onclick="showView('list')" aria-label="View documented windows" class="btn-primary">
                    <span aria-hidden="true">üìã</span> 
                    <span>View Windows</span>
                </button>
                <button onclick="showView('form')" aria-label="Add new window" class="btn-primary">
                    <span aria-hidden="true">‚ûï</span> 
                    <span>Add Window</span>
                </button>
            </div>
            <div class="nav-divider"></div>
            <div class="nav-group">
                <button onclick="importWikidataFile()" aria-label="Import from Wikidata" class="btn-secondary">
                    <span aria-hidden="true">üì•</span> 
                    <span>Import Wikidata</span>
                </button>
                <button onclick="importCSVFile()" aria-label="Import from CSV" class="btn-secondary">
                    <span aria-hidden="true">üìÑ</span> 
                    <span>Import CSV</span>
                </button>
            </div>
            <div class="nav-divider"></div>
            <div class="nav-group">
                <button onclick="exportData()" aria-label="Export as JSON-LD" class="btn-secondary">
                    <span aria-hidden="true">üíæ</span> 
                    <span>Export JSON-LD</span>
                </button>
                <button onclick="exportCSV()" aria-label="Export as CSV" class="btn-secondary">
                    <span aria-hidden="true">üìä</span> 
                    <span>Export CSV</span>
                </button>
                <button onclick="showView('about')" aria-label="About this tool" class="btn-secondary">
                    <span aria-hidden="true">‚ÑπÔ∏è</span> 
                    <span>About</span>
                </button>
            </div>
        </nav>

        <!-- Status Messages -->
        <div id="status-message" aria-live="polite" role="status"></div>

        <!-- Main Content -->
        <main id="main-content">
            
            <!-- LIST VIEW - Documented Windows -->
            <div id="list-view" class="view active">
                <div class="view-header">
                    <h2>Documented Windows</h2>
                    
                    <!-- Search & Filter Interface -->
                    <div class="search-filter-container">
                        <div class="search-row">
                            <div class="search-box">
                                <input 
                                    type="text" 
                                    id="search-input" 
                                    placeholder="Search windows by title, location, or description..." 
                                    aria-label="Search windows by title, location, or description"
                                    autocomplete="off"
                                >
                                <button 
                                    type="button" 
                                    class="search-clear" 
                                    onclick="clearSearch()" 
                                    aria-label="Clear search"
                                    style="display: none;"
                                >
                                    <span aria-hidden="true">‚úï</span>
                                </button>
                            </div>
                            <div class="filter-controls">
                                <div class="filter-group">
                                    <label for="country-filter">Country:</label>
                                    <select id="country-filter">
                                        <option value="">All Countries</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="material-filter">Material:</label>
                                    <select id="material-filter">
                                        <option value="">All Materials</option>
                                        <option value="Stained Glass">Stained Glass</option>
                                        <option value="Painted Glass">Painted Glass</option>
                                        <option value="Clear Glass">Clear Glass</option>
                                        <option value="Lead Came">Lead Came</option>
                                        <option value="Silver Stain">Silver Stain</option>
                                        <option value="Vitreous Paint">Vitreous Paint</option>
                                    </select>
                                </div>
                                <div class="filter-group">
                                    <label for="date-filter">Date Range:</label>
                                    <select id="date-filter">
                                        <option value="">All Periods</option>
                                        <option value="medieval">Medieval (pre-1500)</option>
                                        <option value="renaissance">Renaissance (1500-1650)</option>
                                        <option value="baroque">Baroque (1650-1750)</option>
                                        <option value="modern">Modern (1750+)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div id="search-status" class="search-status" aria-live="polite"></div>
                    </div>
                </div>

                <!-- Statistics Dashboard -->
                <div class="stats" role="region" aria-label="Collection statistics">
                    <div class="stat-card">
                        <div class="stat-number" id="total-windows">0</div>
                        <div class="stat-label">Total Windows</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="countries-count">0</div>
                        <div class="stat-label">Countries</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="date-range">-</div>
                        <div class="stat-label">Date Range</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="storage-usage">-</div>
                        <div class="stat-label">Storage Used</div>
                    </div>
                </div>

                <!-- View Toggle Buttons -->
                <div class="view-toggle">
                    <button onclick="toggleView('table')" class="btn-secondary" id="table-view-btn">
                        <span aria-hidden="true">üìã</span> Table View
                    </button>
                    <button onclick="toggleView('cards')" class="btn-secondary active" id="card-view-btn">
                        <span aria-hidden="true">üóÇÔ∏è</span> Card View
                    </button>
                </div>

                <!-- Bulk Actions Bar -->
                <div id="bulk-actions" class="bulk-actions" style="display: none;">
                    <div class="bulk-actions-info">
                        <span id="selected-count">0</span> windows selected
                    </div>
                    <div class="bulk-actions-controls">
                        <button onclick="exportSelected()" class="btn-secondary btn-sm">
                            <span aria-hidden="true">üì§</span> Export Selected
                        </button>
                        <button onclick="deleteSelected()" class="btn-danger btn-sm">
                            <span aria-hidden="true">üóëÔ∏è</span> Delete Selected
                        </button>
                        <button onclick="clearSelection()" class="btn-secondary btn-sm">
                            Clear Selection
                        </button>
                    </div>
                </div>

                <!-- Data Table View -->
                <div id="data-table-view" class="data-table-container" style="display: none;">
                    <table class="data-table" role="table" aria-label="Windows data table">
                        <thead>
                            <tr>
                                <th class="col-select">
                                    <input type="checkbox" id="select-all" onchange="toggleSelectAll()" aria-label="Select all windows">
                                </th>
                                <th class="col-title sortable" onclick="sortTable('title')" tabindex="0" role="button" aria-label="Sort by title">
                                    Title
                                </th>
                                <th class="col-location sortable" onclick="sortTable('location')" tabindex="0" role="button" aria-label="Sort by location">
                                    Location
                                </th>
                                <th class="col-date sortable" onclick="sortTable('date')" tabindex="0" role="button" aria-label="Sort by date">
                                    Date
                                </th>
                                <th class="col-materials">Materials</th>
                                <th class="col-actions">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="table-body">
                            <!-- Dynamic content populated by JavaScript -->
                        </tbody>
                    </table>
                    <div class="pagination">
                        <div class="pagination-info">
                            <span id="pagination-info">Showing 0 of 0 windows</span>
                        </div>
                        <div class="pagination-controls">
                            <button onclick="previousPage()" class="btn-sm" id="prev-btn" disabled aria-label="Previous page">
                                <span aria-hidden="true">‚Äπ</span>
                            </button>
                            <div id="page-numbers">
                                <!-- Dynamic page numbers -->
                            </div>
                            <button onclick="nextPage()" class="btn-sm" id="next-btn" disabled aria-label="Next page">
                                <span aria-hidden="true">‚Ä∫</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Card View -->
                <div id="windows-list" class="window-list" role="region" aria-label="List of documented windows">
                    <!-- Dynamic content populated by JavaScript -->
                </div>
            </div>

            <!-- FORM VIEW - Add/Edit Window -->
            <div id="form-view" class="view">
                <div class="view-header">
                    <h2 id="form-title">Add New Window</h2>
                    <div class="form-help">
                        <p>Fields marked with <span class="required" aria-label="required">*</span> are required for documentation</p>
                    </div>
                </div>

                <form id="window-form" novalidate>
                    <!-- Basic Window Information -->
                    <fieldset>
                        <legend>Basic Window Information</legend>
                        
                        <div class="form-group">
                            <label for="title">
                                Window Title 
                                <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="title" 
                                name="title" 
                                required 
                                aria-describedby="title-help"
                                autocomplete="off"
                                placeholder="e.g., Rose Window of Notre-Dame"
                            >
                            <small id="title-help" class="help-text">A descriptive name for this window</small>
                        </div>

                        <div class="form-group">
                            <label for="building">
                                Building/Institution 
                                <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="building" 
                                name="building" 
                                required 
                                aria-describedby="building-help"
                                autocomplete="off"
                                placeholder="e.g., Cathedral of Notre-Dame"
                            >
                            <small id="building-help" class="help-text">Church, cathedral, museum, or other building where the window is located</small>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="city">
                                    City 
                                    <span class="required" aria-label="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="city" 
                                    name="city" 
                                    required 
                                    autocomplete="address-level2"
                                    placeholder="e.g., Paris"
                                >
                            </div>

                            <div class="form-group">
                                <label for="country">
                                    Country 
                                    <span class="required" aria-label="required">*</span>
                                </label>
                                <input 
                                    type="text" 
                                    id="country" 
                                    name="country" 
                                    required 
                                    autocomplete="country"
                                    placeholder="e.g., France"
                                >
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="date">
                                Creation Date 
                                <span class="required" aria-label="required">*</span>
                            </label>
                            <input 
                                type="text" 
                                id="date" 
                                name="date" 
                                required 
                                placeholder="e.g., 1920, c. 1850, 13th century"
                                aria-describedby="date-help"
                                autocomplete="off"
                            >
                            <small id="date-help" class="help-text">Use any format that describes when the window was created</small>
                        </div>

                        <!-- Materials Selection -->
                        <div class="form-group">
                            <fieldset>
                                <legend>
                                    Materials Used 
                                    <span class="required" aria-label="required">*</span>
                                </legend>
                                <div class="checkbox-group" role="group" aria-describedby="materials-help">
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-stained-glass" name="materials" value="Stained Glass">
                                        <label for="mat-stained-glass">Stained Glass</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-painted-glass" name="materials" value="Painted Glass">
                                        <label for="mat-painted-glass">Painted Glass</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-clear-glass" name="materials" value="Clear Glass">
                                        <label for="mat-clear-glass">Clear Glass</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-lead-came" name="materials" value="Lead Came">
                                        <label for="mat-lead-came">Lead Came</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-silver-stain" name="materials" value="Silver Stain">
                                        <label for="mat-silver-stain">Silver Stain</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-vitreous-paint" name="materials" value="Vitreous Paint">
                                        <label for="mat-vitreous-paint">Vitreous Paint</label>
                                    </div>
                                    <div class="checkbox-item">
                                        <input type="checkbox" id="mat-other" name="materials" value="Other">
                                        <label for="mat-other">Other Materials</label>
                                    </div>
                                </div>
                                <input 
                                    type="text" 
                                    id="materials-other" 
                                    name="materialsOther" 
                                    placeholder="Specify other materials used" 
                                    style="margin-top: 0.75rem; display: none;"
                                    aria-label="Other materials specification"
                                >
                                <small id="materials-help" class="help-text">Select all materials that apply to this window</small>
                            </fieldset>
                        </div>
                    </fieldset>

                    <!-- Optional Fields Section -->
                    <div class="optional-section">
                        <button 
                            type="button" 
                            class="optional-toggle" 
                            onclick="toggleOptionalFields()"
                            aria-expanded="false"
                            aria-controls="optional-fields"
                        >
                            <span id="optional-toggle-text">Show Optional Fields</span>
                            <span class="toggle-icon" aria-hidden="true">‚ñº</span>
                        </button>
                        
                        <div id="optional-fields" class="optional-fields">
                            <fieldset>
                                <legend>Optional Window Details</legend>
                                
                                <div class="form-group">
                                    <label for="alternative-titles">Alternative Titles</label>
                                    <input 
                                        type="text" 
                                        id="alternative-titles" 
                                        name="alternativeTitles" 
                                        placeholder="Separate multiple titles with commas"
                                        aria-describedby="alt-titles-help"
                                        autocomplete="off"
                                    >
                                    <small id="alt-titles-help" class="help-text">Other names this window is known by</small>
                                </div>

                                <div class="form-group">
                                    <label for="specific-location">Specific Location within Building</label>
                                    <input 
                                        type="text" 
                                        id="specific-location" 
                                        name="specificLocation" 
                                        placeholder="e.g., North transept, Chapel of St. Mary"
                                        aria-describedby="location-help"
                                        autocomplete="off"
                                    >
                                    <small id="location-help" class="help-text">More precise location within the building</small>
                                </div>

                                <div class="form-group">
                                    <label>Window Dimensions</label>
                                    <div class="form-row-3">
                                        <div class="form-group">
                                            <label for="width" class="sr-only">Width</label>
                                            <input 
                                                type="number" 
                                                id="width" 
                                                name="width" 
                                                placeholder="Width" 
                                                step="0.1"
                                                min="0"
                                                aria-label="Window width"
                                            >
                                        </div>
                                        <div class="form-group">
                                            <label for="height" class="sr-only">Height</label>
                                            <input 
                                                type="number" 
                                                id="height" 
                                                name="height" 
                                                placeholder="Height" 
                                                step="0.1"
                                                min="0"
                                                aria-label="Window height"
                                            >
                                        </div>
                                        <div class="form-group">
                                            <label for="dimension-unit" class="sr-only">Measurement unit</label>
                                            <select id="dimension-unit" name="dimensionUnit" aria-label="Dimension unit">
                                                <option value="cm">cm</option>
                                                <option value="m">m</option>
                                                <option value="in">in</option>
                                                <option value="ft">ft</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="image-url">Image URL</label>
                                    <input 
                                        type="url" 
                                        id="image-url" 
                                        name="imageUrl" 
                                        placeholder="https://commons.wikimedia.org/wiki/Special:FilePath/..."
                                        aria-describedby="image-help"
                                        autocomplete="off"
                                    >
                                    <small id="image-help" class="help-text">
                                        Wikimedia Commons image URL (will be displayed as thumbnail in the gallery)
                                    </small>
                                    <div id="image-preview" class="image-preview" aria-live="polite"></div>
                                </div>

                                <div class="form-group">
                                    <label for="description">Detailed Description</label>
                                    <textarea 
                                        id="description" 
                                        name="description" 
                                        placeholder="Describe the window's iconography, artistic style, condition, historical significance, or other notable features..."
                                        aria-describedby="description-help"
                                        rows="4"
                                    ></textarea>
                                    <small id="description-help" class="help-text">Detailed description of the window's appearance, significance, and context</small>
                                </div>

                                <div class="form-group">
                                    <label for="subject-tags">Subject/Iconography Tags</label>
                                    <input 
                                        type="text" 
                                        id="subject-tags" 
                                        name="subjectTags" 
                                        placeholder="e.g., Christ, Virgin Mary, saints, biblical scenes, Last Judgment (separate with commas)"
                                        aria-describedby="tags-help"
                                        autocomplete="off"
                                    >
                                    <small id="tags-help" class="help-text">Keywords describing the window's subject matter and iconographic elements</small>
                                </div>
                            </fieldset>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="form-actions">
                        <button type="submit" id="save-btn" class="btn-primary">
                            <span aria-hidden="true">üíæ</span> 
                            <span>Save Window</span>
                        </button>
                        <button type="button" class="btn-secondary" onclick="resetForm()">
                            <span aria-hidden="true">üîÑ</span> 
                            <span>Clear Form</span>
                        </button>
                        <button type="button" class="btn-secondary" onclick="showView('list')">
                            <span aria-hidden="true">‚ùå</span> 
                            <span>Cancel</span>
                        </button>
                    </div>
                </form>
            </div>

            <!-- ABOUT VIEW - Information and Help -->
            <div id="about-view" class="view">
                <div class="view-header">
                    <h2>About This Tool</h2>
                </div>
                
                <div class="about-content">
                    <section aria-labelledby="about-overview">
                        <h3 id="about-overview">Overview</h3>
                        <p>The Stained Glass Documentation Tool is a comprehensive research platform designed to help scholars, historians, and cultural heritage professionals document stained glass windows with structured metadata that can be exported in standard formats for long-term preservation and academic sharing.</p>
                    </section>

                    <section aria-labelledby="about-features">
                        <h3 id="about-features">Key Features</h3>
                        <ul>
                            <li><strong>Complete offline functionality</strong> - No internet connection required for documentation work</li>
                            <li><strong>Dual view modes</strong> - Switch between card view and professional table view</li>
                            <li><strong>Advanced search and filtering</strong> - Real-time search with country, material, and date filters</li>
                            <li><strong>Bulk operations</strong> - Select multiple windows for export or deletion</li>
                            <li><strong>Standards-compliant export</strong> - JSON-LD and CSV formats following Schema.org specifications</li>
                            <li><strong>Comprehensive import capabilities</strong> - Import from Wikidata exports and CSV spreadsheets</li>
                            <li><strong>Image management</strong> - Wikimedia Commons integration with lazy loading</li>
                            <li><strong>Full accessibility support</strong> - WCAG 2.1 AA compliance with keyboard navigation</li>
                            <li><strong>Auto-save functionality</strong> - Automatic draft saving prevents data loss</li>
                            <li><strong>Responsive design</strong> - Works seamlessly on desktop, tablet, and mobile devices</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-getting-started">
                        <h3 id="about-getting-started">Getting Started</h3>
                        <ol>
                            <li>Click <strong>"Add Window"</strong> to begin documenting your first stained glass window</li>
                            <li>Complete all required fields (marked with <span class="required">*</span>) for basic documentation</li>
                            <li>Expand the optional fields section for detailed scholarly information</li>
                            <li>Save your record and continue documenting additional windows</li>
                            <li>Use the search functionality and filters to locate specific windows</li>
                            <li>Switch between card and table view for different browsing experiences</li>
                            <li>Use bulk actions in table view to manage multiple windows efficiently</li>
                            <li>Export your research data in JSON-LD or CSV format for preservation or sharing</li>
                        </ol>
                    </section>

                    <section aria-labelledby="about-table-view">
                        <h3 id="about-table-view">Table View & Bulk Operations</h3>
                        <ul>
                            <li><strong>Sortable columns</strong> - Click any column header to sort data ascending or descending</li>
                            <li><strong>Bulk selection</strong> - Select multiple windows using checkboxes for batch operations</li>
                            <li><strong>Advanced filtering</strong> - Filter by country, material type, and date ranges simultaneously</li>
                            <li><strong>Pagination</strong> - Navigate through large collections efficiently with page controls</li>
                            <li><strong>Bulk export</strong> - Export only selected windows rather than entire collection</li>
                            <li><strong>Bulk delete</strong> - Remove multiple windows at once with confirmation dialogs</li>
                        </ul>
                    </section>

                    <section aria-labelledby="about-version">
                        <h3 id="about-version">Version Information</h3>
                        <p>
                            <strong>Version:</strong> 2.0 with Complete Table View & Bulk Operations<br>
                            <strong>Last Updated:</strong> 2025<br>
                            <strong>License:</strong> Open Source<br>
                            <strong>Status:</strong> Production Ready for Academic Use
                        </p>
                        
                        <p>This tool has been successfully tested with collections of 3,789+ windows and includes advanced features for professional database management workflows.</p>
                    </section>
                </div>
            </div>
        </main>
    </div>

    <!-- MODAL DIALOGS -->
    
    <!-- Delete Confirmation Modal -->
    <div id="delete-modal" class="modal" role="dialog" aria-labelledby="delete-modal-title" aria-hidden="true">
        <div class="modal-content">
            <h3 id="delete-modal-title">Confirm Deletion</h3>
            <p id="delete-modal-text">Are you sure you want to permanently delete this window record? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn-danger" onclick="confirmDelete()">
                    <span aria-hidden="true">üóëÔ∏è</span> 
                    <span>Delete Permanently</span>
                </button>
                <button class="btn-secondary" onclick="closeModal()">
                    <span aria-hidden="true">‚ùå</span> 
                    <span>Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Bulk Delete Confirmation Modal -->
    <div id="bulk-delete-modal" class="modal" role="dialog" aria-labelledby="bulk-delete-modal-title" aria-hidden="true">
        <div class="modal-content">
            <h3 id="bulk-delete-modal-title">Confirm Bulk Deletion</h3>
            <p id="bulk-delete-modal-text">Are you sure you want to permanently delete <span id="bulk-delete-count">0</span> selected window records? This action cannot be undone.</p>
            <div class="modal-actions">
                <button class="btn-danger" onclick="confirmBulkDelete()">
                    <span aria-hidden="true">üóëÔ∏è</span> 
                    <span>Delete All Selected</span>
                </button>
                <button class="btn-secondary" onclick="closeModal()">
                    <span aria-hidden="true">‚ùå</span> 
                    <span>Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Export Options Modal -->
    <div id="export-modal" class="modal" role="dialog" aria-labelledby="export-modal-title" aria-hidden="true">
        <div class="modal-content">
            <h3 id="export-modal-title">Export Selected Windows</h3>
            <p>Choose the format for exporting <span id="export-count">0</span> selected windows:</p>
            <div class="modal-actions">
                <button class="btn-primary" onclick="exportSelectedAs('json')">
                    <span aria-hidden="true">üíæ</span> 
                    <span>Export as JSON-LD</span>
                </button>
                <button class="btn-primary" onclick="exportSelectedAs('csv')">
                    <span aria-hidden="true">üìä</span> 
                    <span>Export as CSV</span>
                </button>
                <button class="btn-secondary" onclick="closeModal()">
                    <span aria-hidden="true">‚ùå</span> 
                    <span>Cancel</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Image Viewer Modal -->
    <div id="image-modal" class="image-modal" role="dialog" aria-labelledby="modal-caption" aria-hidden="true">
        <div class="modal-image-container">
            <button class="modal-close" onclick="closeImageModal()" aria-label="Close image viewer">
                <span aria-hidden="true">&times;</span>
            </button>
            <img id="modal-image" class="modal-image" src="" alt="" tabindex="0">
            <div id="modal-caption" class="modal-caption"></div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="app.js"></script>
    <script src="import-export.js"></script>
    <script src="table.js"></script>
    
    <script>
        // Expose global variables for table.js
        window.windows = windows;
        window.filteredWindows = filteredWindows;
    </script>

    <script>
        // Initialize components
        document.addEventListener('DOMContentLoaded', function() {
            // Set last updated date (if element exists)
            const lastUpdatedElement = document.getElementById('last-updated');
            if (lastUpdatedElement) {
                lastUpdatedElement.textContent = new Date().getFullYear();
            }
            
            // Initialize search clear button and integrate with filters
            document.getElementById('search-input').addEventListener('input', function() {
                const clearButton = document.querySelector('.search-clear');
                clearButton.style.display = this.value ? 'block' : 'none';
                
                // Trigger both search and filter update
                if (typeof updateCardViewWithFilters === 'function') {
                    updateCardViewWithFilters();
                }
                
                // Also trigger table update if table view is active
                if (document.getElementById('data-table-view').style.display !== 'none') {
                    if (typeof loadTableData === 'function') {
                        loadTableData();
                    }
                }
            });

            // Image modal keyboard handling
            document.addEventListener('keydown', function(e) {
                const modal = document.getElementById('image-modal');
                if (modal.getAttribute('aria-hidden') === 'false') {
                    if (e.key === 'Escape') {
                        closeImageModal();
                    }
                }
            });

            // Click outside modal to close
            document.getElementById('image-modal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeImageModal();
                }
            });

            // Image URL preview functionality
            const imageUrlInput = document.getElementById('image-url');
            if (imageUrlInput) {
                imageUrlInput.addEventListener('input', function() {
                    const url = this.value;
                    const preview = document.getElementById('image-preview');
                    
                    if (url && url.includes('commons.wikimedia.org')) {
                        let thumbnailUrl = url;
                        
                        if (url.includes('wiki/File:')) {
                            const filename = url.split('File:')[1];
                            thumbnailUrl = `https://commons.wikimedia.org/wiki/Special:FilePath/${filename}`;
                        }
                        
                        if (thumbnailUrl.includes('Special:FilePath/')) {
                            thumbnailUrl += (thumbnailUrl.includes('?') ? '&' : '?') + 'width=200';
                        }
                        
                        preview.innerHTML = `
                            <img src="${thumbnailUrl}" 
                                 alt="Preview" 
                                 class="form-image-preview"
                                 onerror="this.style.display='none'">
                        `;
                    } else {
                        preview.innerHTML = '';
                    }
                });
            }

            console.log('Application initialized with table view support');
        });

        // Modal functions
        function closeModal() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.setAttribute('aria-hidden', 'true');
                modal.style.display = 'none';
            });
        }

        function closeImageModal() {
            const modal = document.getElementById('image-modal');
            modal.setAttribute('aria-hidden', 'true');
            modal.style.display = 'none';
        }

        // Optional fields toggle
        function toggleOptionalFields() {
            const button = document.querySelector('.optional-toggle');
            const fields = document.getElementById('optional-fields');
            const text = document.getElementById('optional-toggle-text');
            const icon = document.querySelector('.toggle-icon');
            
            const isExpanded = button.getAttribute('aria-expanded') === 'true';
            
            if (isExpanded) {
                button.setAttribute('aria-expanded', 'false');
                fields.classList.remove('open');
                text.textContent = 'Show Optional Fields';
                icon.style.transform = 'rotate(0deg)';
            } else {
                button.setAttribute('aria-expanded', 'true');
                fields.classList.add('open');
                text.textContent = 'Hide Optional Fields';
                icon.style.transform = 'rotate(180deg)';
            }
        }
    </script>
</body>
</html>